<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BirdsLoMLab - Legend of Mushroom Calculators</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #fff;
        }

        /* ===== MAIN NAVIGATION ===== */
        .main-header {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .main-header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .main-header .tagline {
            opacity: 0.8;
            font-size: 0.95em;
        }

        /* ===== TAB NAVIGATION ===== */
        .tab-navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.3);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        /* ===== TAB CONTENT ===== */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== HP DAMAGE CALCULATOR STYLES ===== */
        #hp-calc-tab {
            padding: 20px;
        }

        #hp-calc-tab .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            color: #333;
        }

        #hp-calc-tab .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        #hp-calc-tab .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        #hp-calc-tab .header p {
            opacity: 0.9;
            font-size: 0.95em;
        }

        #hp-calc-tab .content {
            padding: 30px;
        }

        #hp-calc-tab .input-section {
            margin-bottom: 30px;
        }

        #hp-calc-tab .section-title {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-weight: 600;
        }

        #hp-calc-tab .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        #hp-calc-tab .input-group {
            display: flex;
            flex-direction: column;
        }

        #hp-calc-tab label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        #hp-calc-tab input, #hp-calc-tab select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            color: #333;
            background: #fff;
        }

        #hp-calc-tab input:focus, #hp-calc-tab select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        #hp-calc-tab input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        #hp-calc-tab .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }

        #hp-calc-tab .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #hp-calc-tab .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        #hp-calc-tab .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        #hp-calc-tab .buff-indicator {
            color: #27ae60;
            font-weight: 600;
        }

        #hp-calc-tab .debuff-indicator {
            color: #e74c3c;
            font-weight: 600;
        }

        #hp-calc-tab .calc-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        #hp-calc-tab .calc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        #hp-calc-tab .results {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }

        #hp-calc-tab .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        #hp-calc-tab .result-item:last-child {
            margin-bottom: 0;
        }

        #hp-calc-tab .result-label {
            font-weight: 600;
            color: #555;
        }

        #hp-calc-tab .result-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
        }

        #hp-calc-tab .result-value.uncapped {
            color: #764ba2;
        }

        #hp-calc-tab .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #856404;
        }

        #hp-calc-tab .calculation-steps {
            background: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.85em;
            line-height: 1.6;
        }

        #hp-calc-tab .calculation-steps h4 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        #hp-calc-tab .step {
            margin: 8px 0;
            color: #0d47a1;
        }

        /* ===== GUARDIAN LIFE CALCULATOR STYLES ===== */
        #guardian-tab {
            padding: 20px;
        }

        #guardian-tab .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        #guardian-tab header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        #guardian-tab header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        #guardian-tab .credit {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        #guardian-tab .battle-setup {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        #guardian-tab .guardian-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        #guardian-tab .guardian-panel.player {
            border-color: rgba(76, 175, 80, 0.5);
        }

        #guardian-tab .guardian-panel.opponent {
            border-color: rgba(244, 67, 54, 0.5);
        }

        #guardian-tab .panel-header {
            font-size: 1.5em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        #guardian-tab .input-group {
            margin-bottom: 15px;
        }

        #guardian-tab label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9em;
            color: #fff;
        }

        #guardian-tab select, #guardian-tab input[type="number"] {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1em;
        }

        #guardian-tab select option {
            background: #1e3c72;
            color: #fff;
        }

        #guardian-tab input[type="number"]:focus, #guardian-tab select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }

        #guardian-tab .stat-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        #guardian-tab .stat-item {
            text-align: center;
        }

        #guardian-tab .stat-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        #guardian-tab .stat-value {
            font-size: 1.2em;
            font-weight: bold;
        }

        #guardian-tab .battle-button {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            margin-bottom: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #guardian-tab .battle-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        #guardian-tab .results {
            display: none;
            margin-bottom: 30px;
        }

        #guardian-tab .results.active {
            display: block;
        }

        #guardian-tab .result-summary {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        #guardian-tab .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        #guardian-tab .result-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        #guardian-tab .result-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        #guardian-tab .result-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        #guardian-tab .winner {
            color: #4caf50;
        }

        #guardian-tab .loser {
            color: #f44336;
        }

        #guardian-tab .visual-battle {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        #guardian-tab .battle-arena {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px;
            min-height: 200px;
            position: relative;
        }

        #guardian-tab .guardian-visual {
            text-align: center;
            width: 200px;
        }

        #guardian-tab .guardian-icon {
            font-size: 5em;
            margin-bottom: 10px;
            transition: transform 0.3s;
        }

        #guardian-tab .guardian-visual.dead .guardian-icon {
            opacity: 0.3;
            filter: grayscale(100%);
        }

        #guardian-tab .guardian-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #guardian-tab .health-bar-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            margin-bottom: 5px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        #guardian-tab .health-bar {
            height: 100%;
            background: linear-gradient(90deg, #4caf50 0%, #8bc34a 100%);
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        #guardian-tab .health-text {
            font-size: 0.9em;
            opacity: 0.8;
        }

        #guardian-tab .battle-vs {
            font-size: 3em;
            font-weight: bold;
            opacity: 0.5;
        }

        #guardian-tab .battle-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        #guardian-tab .control-button {
            padding: 10px 20px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }

        #guardian-tab .control-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        #guardian-tab .timeline {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        #guardian-tab .timeline-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 40px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        #guardian-tab .timeline-progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
        }

        #guardian-tab .timeline-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 1.1em;
        }

        #guardian-tab .battle-table {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            overflow-x: auto;
        }

        #guardian-tab table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        #guardian-tab th {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 8px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 0;
        }

        #guardian-tab td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #guardian-tab tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        #guardian-tab .table-section-header {
            background: rgba(255, 255, 255, 0.15);
            font-weight: bold;
            text-align: center;
        }

        #guardian-tab .status-alive {
            color: #4caf50;
        }

        #guardian-tab .status-dead {
            color: #f44336;
        }

        /* ===== STAT CALCULATOR STYLES ===== */
        #stat-calc-tab {
            padding: 20px;
        }

        #stat-calc-tab .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            color: #333;
        }

        #stat-calc-tab .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        #stat-calc-tab .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        #stat-calc-tab .header p {
            opacity: 0.9;
            font-size: 0.95em;
        }

        #stat-calc-tab .content {
            padding: 25px;
        }

        #stat-calc-tab .section-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #1a237e;
            padding: 10px 15px;
            background: linear-gradient(135deg, #e8eaf6, #c5cae9);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        #stat-calc-tab .stat-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        #stat-calc-tab .stat-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 12px;
            text-align: center;
            font-size: 0.95em;
        }

        #stat-calc-tab .stat-table th:first-child {
            text-align: left;
            border-radius: 8px 0 0 0;
        }

        #stat-calc-tab .stat-table th:last-child {
            border-radius: 0 8px 0 0;
        }

        #stat-calc-tab .stat-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        #stat-calc-tab .stat-table td:first-child {
            font-weight: 600;
            color: #1a237e;
            white-space: nowrap;
        }

        #stat-calc-tab .stat-table input[type="number"] {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95em;
            text-align: right;
            transition: border-color 0.3s;
            background: #fafafa;
        }

        #stat-calc-tab .stat-table input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }

        #stat-calc-tab .stat-table .upgrade-input {
            border-color: #c8e6c9;
            background: #f1f8f1;
        }

        #stat-calc-tab .stat-table .upgrade-input:focus {
            border-color: #4caf50;
        }

        #stat-calc-tab .results-section {
            margin-top: 10px;
        }

        #stat-calc-tab .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        #stat-calc-tab .results-table th {
            background: #f5f5f5;
            color: #333;
            padding: 10px 12px;
            text-align: center;
            font-size: 0.9em;
            border-bottom: 2px solid #e0e0e0;
        }

        #stat-calc-tab .results-table th:first-child {
            text-align: left;
        }

        #stat-calc-tab .results-table td {
            padding: 10px 12px;
            text-align: center;
            font-size: 1em;
            border-bottom: 1px solid #e0e0e0;
        }

        #stat-calc-tab .results-table td:first-child {
            text-align: left;
            font-weight: 600;
            color: #333;
        }

        #stat-calc-tab .results-table .current-row td {
            background: #fff8e1;
            font-weight: 600;
        }

        #stat-calc-tab .results-table .new-row td {
            background: #e8f5e9;
            font-weight: 700;
        }

        #stat-calc-tab .results-table .diff-row td {
            font-weight: 600;
        }

        #stat-calc-tab .diff-positive {
            color: #2e7d32;
        }

        #stat-calc-tab .diff-negative {
            color: #c62828;
        }

        #stat-calc-tab .diff-zero {
            color: #757575;
        }

        #stat-calc-tab .unit-label {
            font-size: 0.8em;
            color: #757575;
            font-weight: 400;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .tab-navigation {
                flex-direction: column;
                align-items: center;
            }

            .tab-btn {
                width: 80%;
                text-align: center;
            }

            #hp-calc-tab .input-grid {
                grid-template-columns: 1fr;
            }

            #guardian-tab .battle-setup {
                grid-template-columns: 1fr;
            }

            #guardian-tab .battle-arena {
                flex-direction: column;
                gap: 20px;
            }

            #guardian-tab .battle-vs {
                transform: rotate(90deg);
            }

            #stat-calc-tab .stat-table input[type="number"] {
                font-size: 0.85em;
                padding: 6px 8px;
            }
        }

        /* ===== FOOTER ===== */
        .main-footer {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 30px;
            font-size: 0.9em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <!-- ===== MAIN HEADER ===== -->
    <div class="main-header">
        <h1>üçÑ BirdsLoMLab üçÑ</h1>
        <p class="tagline">Legend of Mushroom Calculators & Tools</p>
    </div>

    <!-- ===== TAB NAVIGATION ===== -->
    <div class="tab-navigation">
        <button class="tab-btn active" onclick="switchTab('hp-calc-tab')">‚öîÔ∏è HP Damage Calculator</button>
        <button class="tab-btn" onclick="switchTab('guardian-tab')">üõ°Ô∏è GuardianLife Calculator</button>
        <button class="tab-btn" onclick="switchTab('stat-calc-tab')">üìä Stat Calculator</button>
    </div>

    <!-- ===== HP DAMAGE CALCULATOR TAB ===== -->
    <div id="hp-calc-tab" class="tab-content active">
        <div class="container">
            <div class="header">
                <h1>‚öîÔ∏è Legend of Mushroom</h1>
                <p>HP-Based Damage Calculator</p>
            </div>

            <div class="content">
                <div class="input-section">
                    <div class="section-title">Damage Configuration</div>
                    <div class="input-group">
                        <label for="dmgType">HP Damage Type</label>
                        <select id="dmgType" onchange="toggleCustomScaling()">
                            <option value="playerMaxHP">Player Maximum HP</option>
                            <option value="playerCurrentHP">Player Current HP</option>
                            <option value="enemyMaxHP">Enemy Maximum HP</option>
                            <option value="enemyCurrentHP">Enemy Current HP</option>
                            <option value="enemyMaxHPPal">Enemy Maximum HP (Pal Dmg)</option>
                            <option value="customScaling">Custom Scaling</option>
                        </select>
                    </div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="hpPerc">HP Damage % (e.g., 5 for 5%)</label>
                            <input type="number" id="hpPerc" value="5" step="0.1" min="0">
                        </div>
                        <div class="input-group">
                            <label for="customScaling">Custom Scaling Multiplier (e.g., 2000 for 2000√ó)</label>
                            <input type="number" id="customScaling" value="2000" step="1" min="1" disabled>
                        </div>
                        <div class="input-group">
                            <label for="hpPercent">Target HP % (for Current HP types)</label>
                            <select id="hpPercent">
                                <option value="100">100%</option>
                                <option value="75">75%</option>
                                <option value="50">50%</option>
                                <option value="25">25%</option>
                                <option value="10">10%</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <div class="section-title">Buffs & Debuffs</div>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="temporalCompression">
                            <label for="temporalCompression">Temporal Compression (+30% ATK)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="opponentBreezy">
                            <label for="opponentBreezy">Opponent Breezy (-20% ATK)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="gust">
                            <label for="gust">Gust (+15% ATK)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="coinBomb">
                            <label for="coinBomb">Coin Bomb (+35% Basic ATK Multiplier)</label>
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <div class="section-title">Player Stats</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="playerATK">Player ATK (in Billions, e.g., 5 = 5B)</label>
                            <input type="number" id="playerATK" value="5" step="0.1" min="0">
                        </div>
                        <div class="input-group">
                            <label for="playerHP">Player HP (in Billions, e.g., 1500 = 1500B)</label>
                            <input type="number" id="playerHP" value="1500" step="1" min="0">
                        </div>
                        <div class="input-group">
                            <label for="playerBasicATKMult">Player Basic ATK Multiplier %</label>
                            <input type="number" id="playerBasicATKMult" value="5000" step="100">
                        </div>
                        <div class="input-group">
                            <label for="playerLevel">Player Level</label>
                            <input type="number" id="playerLevel" value="185" min="1" max="220">
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <div class="section-title">Enemy Stats</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="enemyDEF">Enemy DEF (in Billions, e.g., 2 = 2B)</label>
                            <input type="number" id="enemyDEF" value="2" step="0.1" min="0">
                        </div>
                        <div class="input-group">
                            <label for="enemyHP">Enemy HP (in Billions, e.g., 1500 = 1500B)</label>
                            <input type="number" id="enemyHP" value="1500" step="1" min="0">
                        </div>
                        <div class="input-group">
                            <label for="enemyLevel">Enemy Level</label>
                            <input type="number" id="enemyLevel" value="180" min="1" max="220">
                        </div>
                    </div>
                </div>

                <button class="calc-button" onclick="calculateHP()">Calculate Damage</button>

                <div id="hpResults" style="display: none;">
                    <div class="results">
                        <div class="result-item">
                            <span class="result-label">Final HP Damage:</span>
                            <span class="result-value" id="finalDamage">0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Final HP Damage %:</span>
                            <span class="result-value" id="finalDamagePercent" style="font-size: 1.1em;">0%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Uncapped Damage (Infinite ATK):</span>
                            <span class="result-value uncapped" id="uncappedDamage">0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Uncapped Damage %:</span>
                            <span class="result-value uncapped" id="uncappedDamagePercent" style="font-size: 1.1em;">0%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Damage Status:</span>
                            <span class="result-value" id="damageStatus" style="font-size: 1em;">-</span>
                        </div>
                    </div>

                    <div class="calculation-steps" id="calcSteps"></div>

                    <div class="info-box">
                        <strong>Note:</strong> HP-based damage cannot be reduced by resistances and cannot be critical. 
                        The damage is capped between minimum (0.8 √ó Basic ATK DMG) and maximum (50√ó, 100√ó, or 2000√ó Basic ATK DMG depending on HP type).
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== GUARDIANLIFE CALCULATOR TAB ===== -->
    <div id="guardian-tab" class="tab-content">
        <div class="container">
            <header>
                <h1>‚öîÔ∏è GuardianLife Calculator ‚öîÔ∏è</h1>
                <div class="credit">Calculator by Grace (@its_jj_ on Discord) | Web version by Bird</div>
                <div class="credit">Version 1.0 | 2026/01/27</div>
            </header>

            <div class="battle-setup">
                <div class="guardian-panel player">
                    <div class="panel-header">üõ°Ô∏è Your Guardian</div>
                    
                    <div class="input-group">
                        <label for="playerGuardian">Guardian Type</label>
                        <select id="playerGuardian">
                            <option value="Tide">Tide</option>
                            <option value="Flame">Flame</option>
                            <option value="Zephyr">Zephyr</option>
                            <option value="Litho">Litho</option>
                            <option value="Reaper">Reaper</option>
                            <option value="Raider">Raider</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="playerStar">Star Level</label>
                        <select id="playerStar">
                            <option value="1">1 Star</option>
                            <option value="2">2 Star</option>
                            <option value="3">3 Star</option>
                            <option value="4">4 Star</option>
                            <option value="5">5 Star</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="playerTenBoost">Tenacity Boost</label>
                        <input type="number" id="playerTenBoost" value="0" step="100">
                    </div>

                    <div class="input-group">
                        <label for="playerTenGlobal">Global Tenacity (%)</label>
                        <input type="number" id="playerTenGlobal" value="0" step="0.01">
                    </div>

                    <div class="input-group">
                        <label for="playerTpenBoost">TPEN Boost</label>
                        <input type="number" id="playerTpenBoost" value="0" step="10">
                    </div>

                    <div class="input-group">
                        <label for="playerTpenGlobal">Global TPEN (%)</label>
                        <input type="number" id="playerTpenGlobal" value="0" step="0.01">
                    </div>

                    <div class="stat-display">
                        <div class="stat-item">
                            <div class="stat-label">Total Tenacity</div>
                            <div class="stat-value" id="playerTenTotal">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total TPEN</div>
                            <div class="stat-value" id="playerTpenTotal">0</div>
                        </div>
                    </div>
                </div>

                <div class="guardian-panel opponent">
                    <div class="panel-header">‚öîÔ∏è Opponent Guardian</div>
                    
                    <div class="input-group">
                        <label for="opponentGuardian">Guardian Type</label>
                        <select id="opponentGuardian">
                            <option value="Tide">Tide</option>
                            <option value="Flame" selected>Flame</option>
                            <option value="Zephyr">Zephyr</option>
                            <option value="Litho">Litho</option>
                            <option value="Reaper">Reaper</option>
                            <option value="Raider">Raider</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="opponentStar">Star Level</label>
                        <select id="opponentStar">
                            <option value="1">1 Star</option>
                            <option value="2">2 Star</option>
                            <option value="3">3 Star</option>
                            <option value="4">4 Star</option>
                            <option value="5">5 Star</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="opponentTenBoost">Tenacity Boost</label>
                        <input type="number" id="opponentTenBoost" value="0" step="100">
                    </div>

                    <div class="input-group">
                        <label for="opponentTenGlobal">Global Tenacity (%)</label>
                        <input type="number" id="opponentTenGlobal" value="0" step="0.01">
                    </div>

                    <div class="input-group">
                        <label for="opponentTpenBoost">TPEN Boost</label>
                        <input type="number" id="opponentTpenBoost" value="0" step="10">
                    </div>

                    <div class="input-group">
                        <label for="opponentTpenGlobal">Global TPEN (%)</label>
                        <input type="number" id="opponentTpenGlobal" value="0" step="0.01">
                    </div>

                    <div class="stat-display">
                        <div class="stat-item">
                            <div class="stat-label">Total Tenacity</div>
                            <div class="stat-value" id="opponentTenTotal">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total TPEN</div>
                            <div class="stat-value" id="opponentTpenTotal">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="battle-button" onclick="runBattle()">‚öîÔ∏è START BATTLE ‚öîÔ∏è</button>

            <div class="results" id="guardianResults">
                <div class="result-summary">
                    <h2 style="margin-bottom: 15px;">Battle Results</h2>
                    <div class="result-grid">
                        <div class="result-card">
                            <div class="result-label">Winner</div>
                            <div class="result-value winner" id="winner">-</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">Your Death Time</div>
                            <div class="result-value" id="playerDeath">-</div>
                        </div>
                        <div class="result-card">
                            <div class="result-label">Opponent Death Time</div>
                            <div class="result-value" id="opponentDeath">-</div>
                        </div>
                    </div>
                </div>

                <div class="visual-battle">
                    <h3 style="margin-bottom: 15px;">Battle Visualization</h3>
                    <div class="battle-arena" id="battleArena">
                        <div class="guardian-visual" id="playerVisual">
                            <div class="guardian-icon">üõ°Ô∏è</div>
                            <div class="guardian-name" id="playerVisualName">-</div>
                            <div class="health-bar-container">
                                <div class="health-bar" id="playerHealthBar" style="width: 100%;">
                                    <span id="playerHealthPercent">100%</span>
                                </div>
                            </div>
                            <div class="health-text" id="playerHealthText">-</div>
                        </div>

                        <div class="battle-vs">VS</div>

                        <div class="guardian-visual" id="opponentVisual">
                            <div class="guardian-icon">‚öîÔ∏è</div>
                            <div class="guardian-name" id="opponentVisualName">-</div>
                            <div class="health-bar-container">
                                <div class="health-bar" id="opponentHealthBar" style="width: 100%;">
                                    <span id="opponentHealthPercent">100%</span>
                                </div>
                            </div>
                            <div class="health-text" id="opponentHealthText">-</div>
                        </div>
                    </div>

                    <div class="timeline">
                        <div class="timeline-bar">
                            <div class="timeline-progress" id="timelineProgress" style="width: 0%"></div>
                            <div class="timeline-text" id="timelineText">0s / 0s</div>
                        </div>
                    </div>

                    <div class="battle-controls">
                        <button class="control-button" onclick="playBattle()">‚ñ∂Ô∏è Play</button>
                        <button class="control-button" onclick="pauseBattle()">‚è∏Ô∏è Pause</button>
                        <button class="control-button" onclick="resetBattle()">üîÑ Reset</button>
                        <button class="control-button" onclick="speedUp()">‚è© Speed</button>
                    </div>
                </div>

                <div class="battle-table">
                    <h3 style="margin-bottom: 15px;">Turn-by-Turn Data</h3>
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table id="battleTable">
                            <thead>
                                <tr>
                                    <th rowspan="2">Second</th>
                                    <th colspan="5" class="table-section-header">Your Guardian</th>
                                    <th colspan="5" class="table-section-header">Opponent Guardian</th>
                                </tr>
                                <tr>
                                    <th>Start Ten</th>
                                    <th>Lost</th>
                                    <th>Remain Ten</th>
                                    <th>Dealt</th>
                                    <th>Status</th>
                                    <th>Start Ten</th>
                                    <th>Lost</th>
                                    <th>Remain Ten</th>
                                    <th>Dealt</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="battleTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== STAT CALCULATOR TAB ===== -->
    <div id="stat-calc-tab" class="tab-content">
        <div class="container">
            <div class="header">
                <h1>üìä Legend of Mushroom</h1>
                <p>Stat Upgrade Comparison Calculator</p>
            </div>

            <div class="content">
                <!-- Current Stats Section -->
                <div class="section-title">Current Stats</div>
                <table class="stat-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>HP</th>
                            <th>ATK</th>
                            <th>DEF</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Stat Total</td>
                            <td><input type="number" id="statHP" value="0" oninput="calculateStats()"></td>
                            <td><input type="number" id="statATK" value="0" oninput="calculateStats()"></td>
                            <td><input type="number" id="statDEF" value="0" oninput="calculateStats()"></td>
                        </tr>
                        <tr>
                            <td>Base Stat Total (%)</td>
                            <td><input type="number" id="baseHP" value="0" step="0.01" oninput="calculateStats()"></td>
                            <td><input type="number" id="baseATK" value="0" step="0.01" oninput="calculateStats()"></td>
                            <td><input type="number" id="baseDEF" value="0" step="0.01" oninput="calculateStats()"></td>
                        </tr>
                        <tr>
                            <td>Global Stat Total (%)</td>
                            <td><input type="number" id="globalHP" value="0" step="0.01" oninput="calculateStats()"></td>
                            <td><input type="number" id="globalATK" value="0" step="0.01" oninput="calculateStats()"></td>
                            <td><input type="number" id="globalDEF" value="0" step="0.01" oninput="calculateStats()"></td>
                        </tr>
                    </tbody>
                </table>

                <!-- Upgrade Section -->
                <div class="section-title">Upgrade Values</div>
                <table class="stat-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>HP</th>
                            <th>ATK</th>
                            <th>DEF</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>+ Stat</td>
                            <td><input type="number" class="upgrade-input" id="upgStatHP" value="0" oninput="calculateStats()"></td>
                            <td><input type="number" class="upgrade-input" id="upgStatATK" value="0" oninput="calculateStats()"></td>
                            <td><input type="number" class="upgrade-input" id="upgStatDEF" value="0" oninput="calculateStats()"></td>
                        </tr>
                        <tr>
                            <td>+ Base Stat (%)</td>
                            <td><input type="number" class="upgrade-input" id="upgBaseHP" value="0" step="0.01" oninput="calculateStats()"></td>
                            <td><input type="number" class="upgrade-input" id="upgBaseATK" value="0" step="0.01" oninput="calculateStats()"></td>
                            <td><input type="number" class="upgrade-input" id="upgBaseDEF" value="0" step="0.01" oninput="calculateStats()"></td>
                        </tr>
                        <tr>
                            <td>+ Global (%)</td>
                            <td><input type="number" class="upgrade-input" id="upgGlobalHP" value="0" step="0.01" oninput="calculateStats()"></td>
                            <td><input type="number" class="upgrade-input" id="upgGlobalATK" value="0" step="0.01" oninput="calculateStats()"></td>
                            <td><input type="number" class="upgrade-input" id="upgGlobalDEF" value="0" step="0.01" oninput="calculateStats()"></td>
                        </tr>
                    </tbody>
                </table>

                <!-- Results Section -->
                <div class="results-section">
                    <div class="section-title">Results</div>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>HP <span class="unit-label">(Billions)</span></th>
                                <th>ATK <span class="unit-label">(Millions)</span></th>
                                <th>DEF <span class="unit-label">(Millions)</span></th>
                            </tr>
                        </thead>
                        <tbody id="statResultsBody">
                            <tr class="current-row">
                                <td>Current Final</td>
                                <td id="curFinalHP">0.00</td>
                                <td id="curFinalATK">0.00</td>
                                <td id="curFinalDEF">0.00</td>
                            </tr>
                            <tr class="new-row">
                                <td>New Final</td>
                                <td id="newFinalHP">0.00</td>
                                <td id="newFinalATK">0.00</td>
                                <td id="newFinalDEF">0.00</td>
                            </tr>
                            <tr class="diff-row">
                                <td>Difference</td>
                                <td id="diffHP" class="diff-zero">0.00</td>
                                <td id="diffATK" class="diff-zero">0.00</td>
                                <td id="diffDEF" class="diff-zero">0.00</td>
                            </tr>
                            <tr class="diff-row">
                                <td>% Increase</td>
                                <td id="pctHP" class="diff-zero">0.00%</td>
                                <td id="pctATK" class="diff-zero">0.00%</td>
                                <td id="pctDEF" class="diff-zero">0.00%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== FOOTER ===== -->
    <div class="main-footer">
        <p>BirdsLoMLab - Community tools for Legend of Mushroom</p>
    </div>

    <script>
        // ===== TAB SWITCHING =====
        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            // Highlight button
            event.target.classList.add('active');
        }

        // ===== HP DAMAGE CALCULATOR =====
        const pvpReductionFactors = {
            1: 1.00, 2: 1.00, 3: 1.00, 4: 1.00, 5: 1.00, 6: 1.00, 7: 1.00, 8: 1.10, 9: 1.15, 10: 1.40,
            11: 1.60, 12: 1.70, 13: 2.00, 14: 2.10, 15: 2.40, 16: 2.50, 17: 2.55, 18: 2.95, 19: 3.05, 20: 3.45,
            21: 3.85, 22: 4.00, 23: 4.15, 24: 4.25, 25: 4.75, 26: 4.90, 27: 5.05, 28: 5.15, 29: 5.30, 30: 5.80,
            31: 6.45, 32: 6.60, 33: 6.75, 34: 6.95, 35: 7.65, 36: 7.80, 37: 7.95, 38: 8.15, 39: 8.35, 40: 8.50,
            41: 9.35, 42: 9.50, 43: 9.70, 44: 9.90, 45: 10.05, 46: 10.25, 47: 10.45, 48: 10.65, 49: 10.80, 50: 11.00,
            51: 11.95, 52: 12.15, 53: 12.35, 54: 12.55, 55: 12.75, 56: 12.95, 57: 13.15, 58: 13.35, 59: 13.55, 60: 13.75,
            61: 14.90, 62: 15.10, 63: 15.35, 64: 15.55, 65: 16.10, 66: 16.70, 67: 17.30, 68: 17.90, 69: 18.60, 70: 19.20,
            71: 19.90, 72: 20.70, 73: 21.40, 74: 22.20, 75: 23.00, 76: 23.90, 77: 24.80, 78: 25.70, 79: 26.60, 80: 27.60,
            81: 28.60, 82: 29.70, 83: 30.80, 84: 31.90, 85: 33.10, 86: 34.30, 87: 35.60, 88: 36.90, 89: 38.20, 90: 39.60,
            91: 41.10, 92: 42.60, 93: 44.20, 94: 45.80, 95: 47.50, 96: 49.20, 97: 51.00, 98: 52.90, 99: 54.90, 100: 56.90,
            101: 59.00, 102: 61.20, 103: 63.40, 104: 65.80, 105: 68.20, 106: 70.70, 107: 73.30, 108: 76.00, 109: 78.80, 110: 81.70,
            111: 84.70, 112: 87.80, 113: 91.10, 114: 94.40, 115: 97.90, 116: 101.50, 117: 105.20, 118: 109.10, 119: 113.10, 120: 117.30,
            121: 121.60, 122: 126.10, 123: 130.80, 124: 135.60, 125: 140.60, 126: 145.80, 127: 151.00, 128: 156.20, 129: 161.40, 130: 166.60,
            131: 172.00, 132: 177.40, 133: 182.80, 134: 188.20, 135: 193.60, 136: 199.20, 137: 204.80, 138: 210.40, 139: 216.00, 140: 221.60,
            141: 227.40, 142: 233.20, 143: 239.00, 144: 244.80, 145: 250.60, 146: 256.60, 147: 262.60, 148: 268.60, 149: 274.60, 150: 280.60,
            151: 286.70, 152: 292.80, 153: 298.90, 154: 305.00, 155: 311.20, 156: 317.40, 157: 323.60, 158: 329.80, 159: 336.00, 160: 342.30,
            161: 348.60, 162: 354.90, 163: 361.20, 164: 367.50, 165: 373.90, 166: 380.30, 167: 386.70, 168: 393.10, 169: 399.50, 170: 406.00,
            171: 412.50, 172: 419.00, 173: 425.50, 174: 432.00, 175: 438.60, 176: 445.20, 177: 451.80, 178: 458.40, 179: 465.00, 180: 471.70,
            181: 478.40, 182: 485.10, 183: 491.80, 184: 498.50, 185: 505.30, 186: 512.10, 187: 518.90, 188: 525.70, 189: 532.50, 190: 539.40,
            191: 546.30, 192: 553.20, 193: 560.10, 194: 567.00, 195: 574.00, 196: 581.00, 197: 588.00, 198: 595.00, 199: 602.00, 200: 609.00,
            201: 616.10, 202: 623.20, 203: 630.30, 204: 637.40, 205: 644.50, 206: 651.70, 207: 658.90, 208: 666.10, 209: 673.30, 210: 680.50,
            211: 687.80, 212: 695.10, 213: 702.40, 214: 709.70, 215: 717.00, 216: 724.40, 217: 731.80, 218: 739.20, 219: 746.60, 220: 754.00
        };

        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(2);
        }

        function toggleCustomScaling() {
            const dmgType = document.getElementById('dmgType').value;
            const customScalingInput = document.getElementById('customScaling');
            
            if (dmgType === 'customScaling') {
                customScalingInput.disabled = false;
                customScalingInput.style.backgroundColor = 'white';
            } else {
                customScalingInput.disabled = true;
                customScalingInput.style.backgroundColor = '#f5f5f5';
            }
        }

        function calculateHP() {
            const dmgType = document.getElementById('dmgType').value;
            const hpPerc = parseFloat(document.getElementById('hpPerc').value);
            const customScaling = parseFloat(document.getElementById('customScaling').value);
            const hpPercent = parseFloat(document.getElementById('hpPercent').value);
            
            let playerATK = parseFloat(document.getElementById('playerATK').value) * 1e9;
            const playerHP = parseFloat(document.getElementById('playerHP').value) * 1e9;
            let playerBasicATKMult = parseFloat(document.getElementById('playerBasicATKMult').value);
            const playerLevel = parseInt(document.getElementById('playerLevel').value);
            const enemyDEF = parseFloat(document.getElementById('enemyDEF').value) * 1e9;
            const enemyHP = parseFloat(document.getElementById('enemyHP').value) * 1e9;
            const enemyLevel = parseInt(document.getElementById('enemyLevel').value);

            // Get buff/debuff states
            const temporalCompression = document.getElementById('temporalCompression').checked;
            const opponentBreezy = document.getElementById('opponentBreezy').checked;
            const gust = document.getElementById('gust').checked;
            const coinBomb = document.getElementById('coinBomb').checked;

            // Apply buffs/debuffs
            let atkModifier = 1.0;
            let basicATKModifier = 1.0;
            let buffsList = [];

            if (temporalCompression) {
                atkModifier *= 1.30;
                buffsList.push('<span class="buff-indicator">+30% ATK (Temporal Compression)</span>');
            }
            if (opponentBreezy) {
                atkModifier *= 0.80;
                buffsList.push('<span class="debuff-indicator">-20% ATK (Opponent Breezy)</span>');
            }
            if (gust) {
                atkModifier *= 1.15;
                buffsList.push('<span class="buff-indicator">+15% ATK (Gust)</span>');
            }
            if (coinBomb) {
                basicATKModifier *= 1.35;
                buffsList.push('<span class="buff-indicator">+35% Basic ATK Mult (Coin Bomb)</span>');
            }

            // Apply modifiers
            playerATK *= atkModifier;
            playerBasicATKMult *= basicATKModifier;

            let targetHP;
            let isMaxHP;
            let isCustomScaling = false;

            switch(dmgType) {
                case 'playerMaxHP':
                    targetHP = playerHP;
                    isMaxHP = true;
                    break;
                case 'playerCurrentHP':
                    targetHP = playerHP * (hpPercent / 100);
                    isMaxHP = false;
                    break;
                case 'enemyMaxHP':
                    targetHP = enemyHP;
                    isMaxHP = true;
                    break;
                case 'enemyCurrentHP':
                    targetHP = enemyHP * (hpPercent / 100);
                    isMaxHP = false;
                    break;
                case 'enemyMaxHPPal':
                    targetHP = enemyHP;
                    isMaxHP = true;
                    break;
                case 'customScaling':
                    targetHP = enemyHP;
                    isMaxHP = true;
                    isCustomScaling = true;
                    break;
            }

            const avgLevel = Math.floor((playerLevel + enemyLevel) / 2);
            const pvpFactor = pvpReductionFactors[avgLevel] || 1;

            const hpDamage = targetHP * (hpPerc / 100) * pvpFactor;

            const basicATKDamage = Math.max(1, playerATK - enemyDEF) * (playerBasicATKMult / 100);

            const minDamage = basicATKDamage * 0.8;
            let maxMultiplier;
            
            if (isCustomScaling) {
                maxMultiplier = customScaling;
            } else if (dmgType === 'enemyMaxHPPal') {
                maxMultiplier = 2000;
            } else if (isMaxHP) {
                maxMultiplier = 100;
            } else {
                maxMultiplier = 50;
            }
            
            const maxDamage = basicATKDamage * maxMultiplier;

            let damage;
            let status;
            let cappedStep;

            if (hpDamage <= minDamage) {
                damage = minDamage;
                status = 'Capped at Minimum';
                cappedStep = '7';
            } else if (hpDamage >= maxDamage) {
                damage = maxDamage;
                status = 'Capped at Maximum';
                cappedStep = '8';
            } else {
                damage = hpDamage;
                status = 'Within Range (Not Capped)';
                cappedStep = '5';
            }

            const finalDamage = damage / pvpFactor;
            const uncappedDamage = (targetHP * (hpPerc / 100) * pvpFactor) / pvpFactor;

            // Calculate percentages of target HP (use full HP for percentage calculation)
            const targetHPFull = dmgType.includes('Current') ? 
                (dmgType.includes('player') ? playerHP : enemyHP) : targetHP;
            const finalDamagePercent = (finalDamage / targetHPFull) * 100;
            const uncappedDamagePercent = (uncappedDamage / targetHPFull) * 100;

            document.getElementById('finalDamage').textContent = formatNumber(finalDamage);
            document.getElementById('finalDamagePercent').textContent = finalDamagePercent.toFixed(2) + '%';
            document.getElementById('uncappedDamage').textContent = formatNumber(uncappedDamage);
            document.getElementById('uncappedDamagePercent').textContent = uncappedDamagePercent.toFixed(2) + '%';
            document.getElementById('damageStatus').textContent = status;

            let buffStepsHTML = '';
            if (buffsList.length > 0) {
                buffStepsHTML = `<div class="step"><strong>Active Buffs/Debuffs:</strong><br>${buffsList.join('<br>')}</div>`;
            }

            const hpPercentNote = dmgType.includes('Current') ? ` (${hpPercent}% of max)` : '';

            const stepsHTML = `
                <h4>Calculation Steps:</h4>
                ${buffStepsHTML}
                <div class="step"><strong>1. Target HP:</strong> ${formatNumber(targetHP)}${hpPercentNote} (${dmgType})</div>
                <div class="step"><strong>2. Average Level:</strong> ${avgLevel}</div>
                <div class="step"><strong>3. PvP Reduction Factor:</strong> ${pvpFactor.toFixed(2)}</div>
                <div class="step"><strong>4. HP Damage (Step 1 - Before PvP):</strong> ${formatNumber(targetHP * (hpPerc / 100))}</div>
                <div class="step"><strong>5. HP Damage (Step 2 - After √ó PvP Factor):</strong> ${formatNumber(hpDamage)}</div>
                <div class="step"><strong>6. Basic ATK Damage:</strong> (${formatNumber(playerATK)} - ${formatNumber(enemyDEF)}) √ó ${playerBasicATKMult.toFixed(2)}% = ${formatNumber(basicATKDamage)}</div>
                <div class="step"><strong>7. Minimum Damage (0.8√ó):</strong> ${formatNumber(minDamage)}</div>
                <div class="step"><strong>8. Maximum Damage (${maxMultiplier}√ó):</strong> ${formatNumber(maxDamage)}</div>
                <div class="step"><strong>9. Capped Damage (Using Step ${cappedStep}):</strong> ${formatNumber(damage)}</div>
                <div class="step"><strong>10. Final Damage (Step 9 √∑ PvP Factor):</strong> ${formatNumber(finalDamage)}</div>
            `;

            document.getElementById('calcSteps').innerHTML = stepsHTML;
            document.getElementById('hpResults').style.display = 'block';
        }

        // ===== GUARDIANLIFE CALCULATOR =====
        const guardianStats = {
            Tide: [
                { star: 1, tenacity: 43200, tpen: 2160 },
                { star: 2, tenacity: 45000, tpen: 2250 },
                { star: 3, tenacity: 46800, tpen: 2340 },
                { star: 4, tenacity: 48600, tpen: 2430 },
                { star: 5, tenacity: 50400, tpen: 2520 }
            ],
            Flame: [
                { star: 1, tenacity: 28800, tpen: 5040 },
                { star: 2, tenacity: 30000, tpen: 5250 },
                { star: 3, tenacity: 31200, tpen: 5460 },
                { star: 4, tenacity: 32400, tpen: 5670 },
                { star: 5, tenacity: 33600, tpen: 5880 }
            ],
            Zephyr: [
                { star: 1, tenacity: 37800, tpen: 2376 },
                { star: 2, tenacity: 39375, tpen: 2475 },
                { star: 3, tenacity: 40950, tpen: 2574 },
                { star: 4, tenacity: 42525, tpen: 2673 },
                { star: 5, tenacity: 44100, tpen: 2772 }
            ],
            Litho: [
                { star: 1, tenacity: 54000, tpen: 1656 },
                { star: 2, tenacity: 56250, tpen: 1725 },
                { star: 3, tenacity: 58500, tpen: 1794 },
                { star: 4, tenacity: 60750, tpen: 1863 },
                { star: 5, tenacity: 63000, tpen: 1932 }
            ],
            Reaper: [
                { star: 1, tenacity: 24500, tpen: 1225 },
                { star: 2, tenacity: 26000, tpen: 1300 },
                { star: 3, tenacity: 27500, tpen: 1375 },
                { star: 4, tenacity: 29000, tpen: 1450 },
                { star: 5, tenacity: 30500, tpen: 1525 }
            ],
            Raider: [
                { star: 1, tenacity: 29400, tpen: 1764 },
                { star: 2, tenacity: 31200, tpen: 1872 },
                { star: 3, tenacity: 33000, tpen: 1980 },
                { star: 4, tenacity: 34800, tpen: 2088 },
                { star: 5, tenacity: 36600, tpen: 2196 }
            ]
        };

        let battleData = [];
        let animationInterval = null;
        let currentFrame = 0;
        let animationSpeed = 750; // milliseconds per frame (slowed for visual clarity)

        function updateStats() {
            updatePlayerStats();
            updateOpponentStats();
        }

        function updatePlayerStats() {
            const guardian = document.getElementById('playerGuardian').value;
            const star = parseInt(document.getElementById('playerStar').value);
            const tenBoost = parseFloat(document.getElementById('playerTenBoost').value) || 0;
            const tenGlobal = parseFloat(document.getElementById('playerTenGlobal').value) || 0;
            const tpenBoost = parseFloat(document.getElementById('playerTpenBoost').value) || 0;
            const tpenGlobal = parseFloat(document.getElementById('playerTpenGlobal').value) || 0;

            const stats = guardianStats[guardian][star - 1];
            const totalTen = Math.round((stats.tenacity + tenBoost) * (1 + tenGlobal / 100));
            const totalTpen = Math.round((stats.tpen + tpenBoost) * (1 + tpenGlobal / 100));

            document.getElementById('playerTenTotal').textContent = totalTen.toLocaleString();
            document.getElementById('playerTpenTotal').textContent = totalTpen.toLocaleString();
        }

        function updateOpponentStats() {
            const guardian = document.getElementById('opponentGuardian').value;
            const star = parseInt(document.getElementById('opponentStar').value);
            const tenBoost = parseFloat(document.getElementById('opponentTenBoost').value) || 0;
            const tenGlobal = parseFloat(document.getElementById('opponentTenGlobal').value) || 0;
            const tpenBoost = parseFloat(document.getElementById('opponentTpenBoost').value) || 0;
            const tpenGlobal = parseFloat(document.getElementById('opponentTpenGlobal').value) || 0;

            const stats = guardianStats[guardian][star - 1];
            const totalTen = Math.round((stats.tenacity + tenBoost) * (1 + tenGlobal / 100));
            const totalTpen = Math.round((stats.tpen + tpenBoost) * (1 + tpenGlobal / 100));

            document.getElementById('opponentTenTotal').textContent = totalTen.toLocaleString();
            document.getElementById('opponentTpenTotal').textContent = totalTpen.toLocaleString();
        }

        function runBattle() {
            const playerGuardian = document.getElementById('playerGuardian').value;
            const playerStar = parseInt(document.getElementById('playerStar').value);
            const playerStats = guardianStats[playerGuardian][playerStar - 1];
            const playerTenBoost = parseFloat(document.getElementById('playerTenBoost').value) || 0;
            const playerTenGlobal = parseFloat(document.getElementById('playerTenGlobal').value) || 0;
            const playerTpenBoost = parseFloat(document.getElementById('playerTpenBoost').value) || 0;
            const playerTpenGlobal = parseFloat(document.getElementById('playerTpenGlobal').value) || 0;

            const opponentGuardian = document.getElementById('opponentGuardian').value;
            const opponentStar = parseInt(document.getElementById('opponentStar').value);
            const opponentStats = guardianStats[opponentGuardian][opponentStar - 1];
            const opponentTenBoost = parseFloat(document.getElementById('opponentTenBoost').value) || 0;
            const opponentTenGlobal = parseFloat(document.getElementById('opponentTenGlobal').value) || 0;
            const opponentTpenBoost = parseFloat(document.getElementById('opponentTpenBoost').value) || 0;
            const opponentTpenGlobal = parseFloat(document.getElementById('opponentTpenGlobal').value) || 0;

            const playerMaxTen = Math.round((playerStats.tenacity + playerTenBoost) * (1 + playerTenGlobal / 100));
            const playerTotalTpen = Math.round((playerStats.tpen + playerTpenBoost) * (1 + playerTpenGlobal / 100));
            const opponentMaxTen = Math.round((opponentStats.tenacity + opponentTenBoost) * (1 + opponentTenGlobal / 100));
            const opponentTotalTpen = Math.round((opponentStats.tpen + opponentTpenBoost) * (1 + opponentTpenGlobal / 100));

            const playerBleed = Math.round(playerMaxTen * 0.1);
            const opponentBleed = Math.round(opponentMaxTen * 0.1);

            battleData = [];
            let playerStartTen = playerMaxTen;
            let playerRemainTen = playerMaxTen;
            let opponentStartTen = opponentMaxTen;
            let opponentRemainTen = opponentMaxTen;
            let playerDeathTime = null;
            let opponentDeathTime = null;

            for (let second = 0; second <= 10; second++) {
                const playerAlive = playerStartTen > 0;
                const opponentAlive = opponentStartTen > 0;

                // Second 0 is starting state - no damage dealt yet
                // Damage starts at second 1
                const playerDealt = (second > 0 && playerAlive) ? playerTotalTpen : 0;
                const opponentDealt = (second > 0 && opponentAlive) ? opponentTotalTpen : 0;

                // Calculate damage taken (only if alive and after second 0)
                const playerDamageTaken = (second > 0 && playerAlive) ? (opponentDealt + playerBleed) : 0;
                const opponentDamageTaken = (second > 0 && opponentAlive) ? (playerDealt + opponentBleed) : 0;

                playerRemainTen = Math.max(0, playerStartTen - playerDamageTaken);
                opponentRemainTen = Math.max(0, opponentStartTen - opponentDamageTaken);

                battleData.push({
                    second: second,
                    playerStartTen: playerStartTen,
                    playerLost: playerDamageTaken,
                    playerRemainTen: playerRemainTen,
                    playerDealt: playerDealt,
                    playerAlive: playerAlive,
                    opponentStartTen: opponentStartTen,
                    opponentLost: opponentDamageTaken,
                    opponentRemainTen: opponentRemainTen,
                    opponentDealt: opponentDealt,
                    opponentAlive: opponentAlive
                });

                if (playerAlive && !playerDeathTime && playerRemainTen <= 0) {
                    playerDeathTime = second;
                }
                if (opponentAlive && !opponentDeathTime && opponentRemainTen <= 0) {
                    opponentDeathTime = second;
                }

                if (playerDeathTime !== null && opponentDeathTime !== null) {
                    break;
                }

                playerStartTen = playerRemainTen;
                opponentStartTen = opponentRemainTen;
            }

            displayResults(playerGuardian, playerStar, opponentGuardian, opponentStar, playerDeathTime, opponentDeathTime);
            displayBattleTable();
            
            document.getElementById('guardianResults').classList.add('active');
            
            currentFrame = 0;
            resetBattle();
            
            document.getElementById('guardianResults').scrollIntoView({ behavior: 'smooth' });
        }

        function displayResults(playerGuardian, playerStar, opponentGuardian, opponentStar, playerDeathTime, opponentDeathTime) {
            let winner = '';

            if (playerDeathTime === null && opponentDeathTime === null) {
                winner = 'Draw (Time Out)';
            } else if (playerDeathTime === null) {
                winner = `Your ${playerGuardian}`;
            } else if (opponentDeathTime === null) {
                winner = `Opponent's ${opponentGuardian}`;
            } else {
                if (opponentDeathTime < playerDeathTime) {
                    winner = `Your ${playerGuardian}`;
                } else if (playerDeathTime < opponentDeathTime) {
                    winner = `Opponent's ${opponentGuardian}`;
                } else {
                    winner = 'Draw (Simultaneous)';
                }
            }

            document.getElementById('winner').textContent = winner;
            document.getElementById('playerDeath').textContent = playerDeathTime !== null ? playerDeathTime + 's' : 'Survived';
            document.getElementById('opponentDeath').textContent = opponentDeathTime !== null ? opponentDeathTime + 's' : 'Survived';

            document.getElementById('playerVisualName').textContent = `${playerGuardian} ‚≠ê${playerStar}`;
            document.getElementById('opponentVisualName').textContent = `${opponentGuardian} ‚≠ê${opponentStar}`;
        }

        function displayBattleTable() {
            const tbody = document.getElementById('battleTableBody');
            tbody.innerHTML = '';

            battleData.forEach((turn) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${turn.second}</td>
                    <td>${turn.playerStartTen.toLocaleString()}</td>
                    <td>${turn.playerLost.toLocaleString()}</td>
                    <td>${turn.playerRemainTen.toLocaleString()}</td>
                    <td>${turn.playerDealt.toLocaleString()}</td>
                    <td class="${turn.playerAlive ? 'status-alive' : 'status-dead'}">${turn.playerAlive ? 'Alive' : 'Dead'}</td>
                    <td>${turn.opponentStartTen.toLocaleString()}</td>
                    <td>${turn.opponentLost.toLocaleString()}</td>
                    <td>${turn.opponentRemainTen.toLocaleString()}</td>
                    <td>${turn.opponentDealt.toLocaleString()}</td>
                    <td class="${turn.opponentAlive ? 'status-alive' : 'status-dead'}">${turn.opponentAlive ? 'Alive' : 'Dead'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateBattleVisual(frame) {
            if (frame >= battleData.length) {
                pauseBattle();
                return;
            }

            const data = battleData[frame];
            const maxPlayerTen = battleData[0].playerStartTen;
            const maxOpponentTen = battleData[0].opponentStartTen;

            const playerPercent = (data.playerRemainTen / maxPlayerTen * 100).toFixed(1);
            const opponentPercent = (data.opponentRemainTen / maxOpponentTen * 100).toFixed(1);

            document.getElementById('playerHealthBar').style.width = playerPercent + '%';
            document.getElementById('playerHealthPercent').textContent = playerPercent + '%';
            document.getElementById('playerHealthText').textContent = data.playerRemainTen.toLocaleString() + ' HP';

            document.getElementById('opponentHealthBar').style.width = opponentPercent + '%';
            document.getElementById('opponentHealthPercent').textContent = opponentPercent + '%';
            document.getElementById('opponentHealthText').textContent = data.opponentRemainTen.toLocaleString() + ' HP';

            const playerVisual = document.getElementById('playerVisual');
            const opponentVisual = document.getElementById('opponentVisual');

            if (!data.playerAlive) {
                playerVisual.classList.add('dead');
            } else {
                playerVisual.classList.remove('dead');
            }

            if (!data.opponentAlive) {
                opponentVisual.classList.add('dead');
            } else {
                opponentVisual.classList.remove('dead');
            }

            const maxSeconds = battleData[battleData.length - 1].second;
            const timelinePercent = (data.second / maxSeconds * 100);
            document.getElementById('timelineProgress').style.width = timelinePercent + '%';
            document.getElementById('timelineText').textContent = `${data.second}s / ${maxSeconds}s`;
        }

        function playBattle() {
            if (battleData.length === 0) return;
            
            if (animationInterval) {
                clearInterval(animationInterval);
            }

            animationInterval = setInterval(() => {
                if (currentFrame >= battleData.length) {
                    pauseBattle();
                    return;
                }
                updateBattleVisual(currentFrame);
                currentFrame++;
            }, animationSpeed);
        }

        function pauseBattle() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
        }

        function resetBattle() {
            pauseBattle();
            currentFrame = 0;
            if (battleData.length > 0) {
                updateBattleVisual(0);
            }
        }

        function speedUp() {
            if (animationSpeed === 750) {
                animationSpeed = 375;
            } else if (animationSpeed === 375) {
                animationSpeed = 150;
            } else if (animationSpeed === 150) {
                animationSpeed = 75;
            } else {
                animationSpeed = 750;
            }

            if (animationInterval) {
                playBattle();
            }
        }

        // ===== STAT CALCULATOR =====
        function calculateStats() {
            // Read current stats
            const statHP = parseFloat(document.getElementById('statHP').value) || 0;
            const statATK = parseFloat(document.getElementById('statATK').value) || 0;
            const statDEF = parseFloat(document.getElementById('statDEF').value) || 0;

            const baseHP = parseFloat(document.getElementById('baseHP').value) || 0;
            const baseATK = parseFloat(document.getElementById('baseATK').value) || 0;
            const baseDEF = parseFloat(document.getElementById('baseDEF').value) || 0;

            const globalHP = parseFloat(document.getElementById('globalHP').value) || 0;
            const globalATK = parseFloat(document.getElementById('globalATK').value) || 0;
            const globalDEF = parseFloat(document.getElementById('globalDEF').value) || 0;

            // Read upgrade values
            const upgStatHP = parseFloat(document.getElementById('upgStatHP').value) || 0;
            const upgStatATK = parseFloat(document.getElementById('upgStatATK').value) || 0;
            const upgStatDEF = parseFloat(document.getElementById('upgStatDEF').value) || 0;

            const upgBaseHP = parseFloat(document.getElementById('upgBaseHP').value) || 0;
            const upgBaseATK = parseFloat(document.getElementById('upgBaseATK').value) || 0;
            const upgBaseDEF = parseFloat(document.getElementById('upgBaseDEF').value) || 0;

            const upgGlobalHP = parseFloat(document.getElementById('upgGlobalHP').value) || 0;
            const upgGlobalATK = parseFloat(document.getElementById('upgGlobalATK').value) || 0;
            const upgGlobalDEF = parseFloat(document.getElementById('upgGlobalDEF').value) || 0;

            // Formula: Stat * (1 + BaseStat/100) * (1 + Global/100)
            const curHP = statHP * (1 + baseHP / 100) * (1 + globalHP / 100);
            const curATK = statATK * (1 + baseATK / 100) * (1 + globalATK / 100);
            const curDEF = statDEF * (1 + baseDEF / 100) * (1 + globalDEF / 100);

            const newHP = (statHP + upgStatHP) * (1 + (baseHP + upgBaseHP) / 100) * (1 + (globalHP + upgGlobalHP) / 100);
            const newATK = (statATK + upgStatATK) * (1 + (baseATK + upgBaseATK) / 100) * (1 + (globalATK + upgGlobalATK) / 100);
            const newDEF = (statDEF + upgStatDEF) * (1 + (baseDEF + upgBaseDEF) / 100) * (1 + (globalDEF + upgGlobalDEF) / 100);

            // Convert: HP to Billions, ATK/DEF to Millions
            const curHPB = curHP / 1e9;
            const curATKM = curATK / 1e6;
            const curDEFM = curDEF / 1e6;

            const newHPB = newHP / 1e9;
            const newATKM = newATK / 1e6;
            const newDEFM = newDEF / 1e6;

            const diffHPB = newHPB - curHPB;
            const diffATKM = newATKM - curATKM;
            const diffDEFM = newDEFM - curDEFM;

            const pctHP = curHPB !== 0 ? ((diffHPB / curHPB) * 100) : 0;
            const pctATK = curATKM !== 0 ? ((diffATKM / curATKM) * 100) : 0;
            const pctDEF = curDEFM !== 0 ? ((diffDEFM / curDEFM) * 100) : 0;

            // Display current finals
            document.getElementById('curFinalHP').textContent = curHPB.toFixed(2);
            document.getElementById('curFinalATK').textContent = curATKM.toFixed(2);
            document.getElementById('curFinalDEF').textContent = curDEFM.toFixed(2);

            // Display new finals
            document.getElementById('newFinalHP').textContent = newHPB.toFixed(2);
            document.getElementById('newFinalATK').textContent = newATKM.toFixed(2);
            document.getElementById('newFinalDEF').textContent = newDEFM.toFixed(2);

            // Display differences with color coding
            updateDiffCell('diffHP', diffHPB);
            updateDiffCell('diffATK', diffATKM);
            updateDiffCell('diffDEF', diffDEFM);

            // Display % increase with color coding
            updatePctCell('pctHP', pctHP);
            updatePctCell('pctATK', pctATK);
            updatePctCell('pctDEF', pctDEF);
        }

        function updateDiffCell(id, value) {
            const cell = document.getElementById(id);
            cell.textContent = (value >= 0 ? '+' : '') + value.toFixed(2);
            cell.className = value > 0 ? 'diff-positive' : value < 0 ? 'diff-negative' : 'diff-zero';
        }

        function updatePctCell(id, value) {
            const cell = document.getElementById(id);
            cell.textContent = (value >= 0 ? '+' : '') + value.toFixed(2) + '%';
            cell.className = value > 0 ? 'diff-positive' : value < 0 ? 'diff-negative' : 'diff-zero';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Guardian calculator event listeners
            const guardianInputs = document.querySelectorAll('#guardian-tab select, #guardian-tab input[type="number"]');
            guardianInputs.forEach(input => {
                input.addEventListener('change', updateStats);
                input.addEventListener('input', updateStats);
            });

            updateStats();
        });
    </script>
</body>
</html>
